<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Send Chat Message</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        button {
            padding: 10px;
            margin: 10px 0;
            cursor: pointer;
        }
        #log {
            border: 1px solid #ccc;
            padding: 10px;
            height: 300px;
            overflow-y: auto;
            margin-top: 20px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <h1>Send Chat Message</h1>
    
    <button id="connect">Connect WebSocket</button>
    <button id="send-hello">Send "Hello" Message</button>
    <button id="send-quest">Send "Tell me about a quest" Message</button>
    <button id="send-explore">Send "I want to explore" Message</button>
    <button id="send-attack">Send "I want to attack" Message</button>
    
    <div id="log"></div>
    
    <script>
        const connectButton = document.getElementById('connect');
        const sendHelloButton = document.getElementById('send-hello');
        const sendQuestButton = document.getElementById('send-quest');
        const sendExploreButton = document.getElementById('send-explore');
        const sendAttackButton = document.getElementById('send-attack');
        const logDiv = document.getElementById('log');
        
        let socket = null;
        const sessionId = 'test-' + Math.floor(Math.random() * 10000);
        
        function log(message) {
            const entry = document.createElement('div');
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        connectButton.addEventListener('click', () => {
            if (socket) {
                log('Already connected');
                return;
            }
            
            socket = new WebSocket(`ws://localhost:8001/ws/dnd/${sessionId}`);
            
            socket.onopen = () => {
                log('Connected to server');
                
                // Generate a map
                socket.send(JSON.stringify({
                    type: "generate_map",
                    theme: "fantasy adventure",
                    content: "Create a dynamic map for my adventure"
                }));
                
                // Add a character
                setTimeout(() => {
                    socket.send(JSON.stringify({
                        type: "player_action",
                        action: {
                            type: "add_character",
                            character_id: "player-1",
                            character_type: "Adventurer",
                            position: { x: 2, y: 2 }
                        }
                    }));
                    log('Added a character to the map');
                }, 1000);
            };
            
            socket.onmessage = (event) => {
                const message = JSON.parse(event.data);
                log(`Received: ${message.type}`);
                
                if (message.type === 'narration') {
                    log(`Narration: ${message.content}`);
                } else if (message.type === 'chat_message') {
                    log(`Chat: ${message.sender}: ${message.content}`);
                }
            };
            
            socket.onclose = () => {
                log('Disconnected from server');
                socket = null;
            };
            
            socket.onerror = (error) => {
                log(`Error: ${error}`);
            };
        });
        
        sendHelloButton.addEventListener('click', () => {
            if (!socket) {
                log('Not connected');
                return;
            }
            
            socket.send(JSON.stringify({
                type: "player_action",
                action: {
                    type: "chat",
                    message: "Hello",
                    sender: "Player"
                }
            }));
            
            log('Sent: Hello');
        });
        
        sendQuestButton.addEventListener('click', () => {
            if (!socket) {
                log('Not connected');
                return;
            }
            
            socket.send(JSON.stringify({
                type: "player_action",
                action: {
                    type: "chat",
                    message: "Tell me about a quest",
                    sender: "Player"
                }
            }));
            
            log('Sent: Tell me about a quest');
        });
        
        sendExploreButton.addEventListener('click', () => {
            if (!socket) {
                log('Not connected');
                return;
            }
            
            socket.send(JSON.stringify({
                type: "player_action",
                action: {
                    type: "chat",
                    message: "I want to explore the forest",
                    sender: "Player"
                }
            }));
            
            log('Sent: I want to explore the forest');
        });
        
        sendAttackButton.addEventListener('click', () => {
            if (!socket) {
                log('Not connected');
                return;
            }
            
            socket.send(JSON.stringify({
                type: "player_action",
                action: {
                    type: "chat",
                    message: "I want to attack",
                    sender: "Player"
                }
            }));
            
            log('Sent: I want to attack');
        });
    </script>
</body>
</html>
